---
provider: clab
defaults.device: vmx
module: [ vlan ]

nodes:
  r1:
    id: 1
    mgmt.ipv4: 10.10.1.101
    mgmt.ifname: fxp0
  r2:
    id: 2
    mgmt.ipv4: 10.10.1.102
    mgmt.ifname: fxp0
  r3:
    id: 3
    mgmt.ipv4: 10.10.1.103
    mgmt.ifname: fxp0
    vlans:
      vlan103:
        ipv4: 192.168.2.0/31
  r4:
    id: 4
    mgmt.ipv4: 10.10.1.104
    mgmt.ifname: fxp0
  r5:
    id: 5
    mgmt.ipv4: 10.10.1.105
    mgmt.ifname: fxp0
  r6:
    id: 6
    mgmt.ipv4: 10.10.1.106
    mgmt.ifname: fxp0
  r7:
    id: 7
    mgmt.ipv4: 10.10.1.107
    mgmt.ifname: fxp0
  r8:
    id: 8
    mgmt.ipv4: 10.10.1.108
    mgmt.ifname: fxp0
  p2-1:
    id: 9
    mgmt.ipv4: 10.10.1.121
    mgmt.ifname: fxp0
    vlans:
      vlan103:
        ipv4: 192.168.2.1/31
  p3-1:
    id: 10
    mgmt.ipv4: 10.10.1.122
    mgmt.ifname: fxp0

vlans:
  vlan103:
    id: 103
    mode: irb
    ipv4: 192.168.2.0/31
    links:
    - r3:
        ifindex: 2
        name: r3->p2-1
        vlan.trunk: [ vlan103 ]
        type: p2p
        pool: p2_ptp
      p2-1:
        ifindex: 1
        name: p2-1->r3
        vlan.trunk: [ vlan103 ]
        type: p2p
        pool: p2_ptp
  vlan104:
    id: 104
    mode: irb
    ipv4: 192.168.3.0/31
    links:
    - r3:
        ifindex: 2
        name: r3->p3-1
        vlan.trunk: [ vlan104 ]
        type: p2p
        pool: p2_ptp
      p3-1:
        ifindex: 1
        name: p3-1->r3
        vlan.trunk: [ vlan104 ]
        type: p2p
        pool: p2_ptp

links:
  - r1:
      ifindex: 0
      name: r1->r2 (ae0)
    r2:
      ifindex: 0
      name: r2->r1 (ae0)
    pool: l2only
  - r1:
      ifindex: 1
      name: r1->r2 (ae0)
    r2:
      ifindex: 1
      name: r1->r2 (ae0)
    pool: l2only
  - r5:
      ifindex: 0
      name: r5->r6
    r6:
      ifindex: 0
      name: r6->r5
  - r5:
      ifindex: 1
      name: r5->r6
    r6:
      ifindex: 1
      name: r6->r5
  - r2:
      ifindex: 4
      name: r2->r3
      ipv4: 172.20.0.18/31
      type: p2p
    r3:
      ifindex: 1
      name: r3->r2
      ipv4: 172.20.0.19/31
      type: p2p
  - r1:
      ifindex: 3
      name: r1->r4
      ipv4: 172.20.0.25/31
      type: p2p
    r4:
      ifindex: 2
      name: r4->r1
      ipv4: 172.20.0.24/31
      type: p2p
  - r2:
      ifindex: 3
      name: r2->r7
      ipv4: 172.20.0.16/31
      type: p2p
    r7:
      ifindex: 2
      name: r7->r2
      ipv4: 172.20.0.17/31
      type: p2p
  - r3:
      ifindex: 4
      name: r3->r4
      ipv4: 172.20.0.21/31
      type: p2p
    r4:
      ifindex: 1
      name: r4->r3
      ipv4: 172.20.0.20/31
      type: p2p
  - r3:
      ifindex: 5
      name: r3->r6
      ipv4: 172.20.0.23/31
      type: p2p
    r6:
      ifindex: 3
      name: r6->r5
      ipv4: 172.20.0.24/31
      type: p2p
  - r4:
      ifindex: 3
      name: r4->r5
      ipv4: 172.20.0.26/31
      type: p2p
    r5:
      ifindex: 3
      name: r5->r4
      ipv4: 172.20.0.27/31
      type: p2p
  - r5:
      ifindex: 2
      name: r5->r8
      ipv4: 172.20.0.29/31
      type: p2p
    r8:
      ifindex: 3
      name: r6->r5
      ipv4: 172.20.0.28/31
      type: p2p
  - r6:
      ifindex: 2
      name: r6->r7
      ipv4: 172.20.0.30/31
      type: p2p
    r7:
      ifindex: 3
      name: r7->r6
      ipv4: 172.20.0.31/31
      type: p2p
  - r7:
      ifindex: 1
      name: r7->r8
      ipv4: 172.20.0.33/31
      type: p2p
    r8:
      ifindex: 1
      name: r8->r7
      ipv4: 172.20.0.34/31
      type: p2p
  - r8:
      ifindex: 4
      name: r8->r1
      ipv4: 172.20.0.32/31
      type: p2p
    r1:
      ifindex: 4
      name: r1->r8
      ipv4: 172.20.0.31/31
      type: p2p
addressing:
  mgmt:
    ipv4: 10.10.1.0/24
    prefix: 24
    start: 100
  loopback:
    ipv4: 172.16.0.0/24
    prefix: 32
  p2p:
    ipv4: 172.20.0.0/24
    prefix: 31
  p2_p2p:
    ipv4: 192.168.2.0/24
    prefix: 31
  p3_p2p:
    ipv4: 192.168.3.0/24
    prefix: 31
