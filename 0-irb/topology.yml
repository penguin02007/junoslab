---
provider: clab
defaults.device: vmx
module: [ vlan, bgp ]

nodes:
  r1:
    vlans:
      red:
        ipv4: 192.168.1.0/31
    bgp:
      as: 65001
      neighbors:
      - as: 65002
        ipv4: 192.168.1.1
        name: r2
        type: ebgp
  r2:
    vlans:
      red:
        ipv4: 192.168.1.1/31
    bgp:
      as: 65002
      neighbors:
      - as: 65001
        ipv4: 192.168.1.0
        name: r1
        type: ebgp
  r3:
    bgp.as: 65002
  r4:
    vlans:
      blue:
        ipv4: 192.168.2.0/31
    bgp:
      as: 65004
      neighbors:
      - as: 65005
        ipv4: 192.168.2.1
        name: r5
        type: ebgp
  r5:
    vlans:
      blue:
        ipv4: 192.168.2.1/31
    bgp:
      as: 65005
      neighbors:
      - as: 65004
        ipv4: 192.168.2.0
        name: r4
        type: ebgp

vlans:
  red:
    id: 100
    mode: bridge
  blue:
    id: 101
    mode: bridge


links:
  - r1:
    r2:
    vlan.trunk: [ red ]
  - r2:
    r3:
  - r3:
    r4:
  - r4:
    r5:
    vlan.trunk: [ blue ] 

addressing:
  red:
    ipv4: 192.168.1.0/24
    prefix: 31
  blue:
    ipv4: 192.168.2.0/24
    prefix: 31
