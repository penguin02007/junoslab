# vR2 Configuration (Edge / ABR)
# Handles the Route Leaking and Summarization tasks.
## Interfaces
set chassis aggregated-devices ethernet device-count 1
del interfaces ge-0/0/0 unit 0
del interfaces ge-0/0/1 unit 0
set interfaces ge-0/0/0 gigether-options 802.3ad ae0
set interfaces ge-0/0/1 gigether-options 802.3ad ae0
set interfaces ae0 aggregated-ether-options lacp active
set interfaces ae0 unit 0 family inet address 172.20.0.1/31
set protocols lldp interface all
set interfaces lo0 unit 0 family inet address 172.16.0.2/32
set interfaces ge-0/0/4 flexible-vlan-tagging
set interfaces ge-0/0/4 unit 202 vlan-id 202 family inet address 172.30.0.49/30 
## ISO NET Address (Area 49.0002)
set interfaces lo0 unit 0 family iso address 49.0002.1720.1600.0002.00
set interfaces ae0 unit 0 family iso
set interfaces ge-0/0/2 unit 0 family iso
set interfaces ge-0/0/3 unit 0 family iso
## BGP Configuration
set routing-options autonomous-system 54591
set protocols bgp group ebgp type external neighbor 172.30.0.50 peer-as 64666
set policy-options policy-statement isis-to-bgp term 1 from protocol isis
set policy-options policy-statement isis-to-bgp term 1 from protocol direct
set policy-options policy-statement isis-to-bgp term 1 then accpet
set protocols bgp group ebgp export isis-to-bgp
## IS-IS Configuration
### 1. Backbone Links (L2 Only)
del protocols isis
set protocols isis interface ae0.0 level 1 disable
set protocols isis interface ae0.0 point-to-point
set protocols isis interface ge-0/0/3 level 1 disable
set protocols isis interface ge-0/0/3 point-to-point
### 2. Edge Link (L1 Only - to vR4)
set protocols isis interface ge-0/0/2.0 level 2 disable
set protocols isis interface lo0.0 passive
set protocols isis level 1 wide-metrics-only
set protocols isis level 2 wide-metrics-only
### 3. Loopback and metrics */
set protocols isis interface lo0.0 passive
set protocols isis level 1 wide-metrics-only
set protocols isis level 2 wide-metrics-only

### Summarization (L1 to L2)
### Create the aggregate route first
set routing-options aggregate route 172.16.0.0/16
### Export it to IS-IS L2, rejecting specifics is implicit in L1->L2 default behavior usually, but use policy to be explicit
set policy-options policy-statement SUMMARIZE-L1-TO-L2 term SUMMARY from protocol aggregate
set policy-options policy-statement SUMMARIZE-L1-TO-L2 term SUMMARY from route-filter 172.16.0.0/16 exact
set policy-options policy-statement SUMMARIZE-L1-TO-L2 term SUMMARY then accept
set protocols isis export SUMMARIZE-L1-TO-L2

### TASK 2.2: Route Leaking (L2 to L1)
### Leak vR1 Loopback (172.16.0.1) into L1
set policy-options policy-statement LEAK-L2-TO-L1 term LEAK-VR1 from family inet
set policy-options policy-statement LEAK-L2-TO-L1 term LEAK-VR1 from protocol isis
set policy-options policy-statement LEAK-L2-TO-L1 term LEAK-VR1 from level 2
set policy-options policy-statement LEAK-L2-TO-L1 term LEAK-VR1 from route-filter 172.16.0.1/32 exact
set policy-options policy-statement LEAK-L2-TO-L1 term LEAK-VR1 then accept
set protocols isis export LEAK-L2-TO-L1

### TASK 3.1: Connectivity to DC2 (Static + Redistribute)
set routing-options static route 172.16.0.20/32 next-hop 172.30.0.50
set policy-options policy-statement REDIST-STATIC term DC2 from protocol static
set policy-options policy-statement REDIST-STATIC term DC2 from route-filter 172.16.0.20/32 exact
set policy-options policy-statement REDIST-STATIC term DC2 then accept
set protocols isis export REDIST-STATIC
